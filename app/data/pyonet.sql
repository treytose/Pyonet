DROP TABLE device;
CREATE TABLE device (deviceid int NOT NULL AUTO_INCREMENT, name varchar(64) NOT NULL, hostname varchar(64) NOT NULL, description varchar(128) NOT NULL, snmp_version varchar(8) NOT NULL, snmp_community varchar(64) NOT NULL, snmp_port int DEFAULT 161, pollerid int NOT NULL, PRIMARY KEY (deviceid), INDEX pollerid (pollerid)) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 DEFAULT COLLATE=utf8mb4_general_ci;
DROP TABLE permission;
CREATE TABLE permission (permissionid int NOT NULL AUTO_INCREMENT, name varchar(32), description varchar(128), PRIMARY KEY (permissionid)) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 DEFAULT COLLATE=utf8mb4_general_ci;
DROP TABLE poller;
CREATE TABLE poller (pollerid int NOT NULL AUTO_INCREMENT, name varchar(64) NOT NULL, description varchar(256) NOT NULL, api_key varchar(128) NOT NULL, PRIMARY KEY (pollerid)) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 DEFAULT COLLATE=utf8mb4_general_ci;
DROP TABLE role;
CREATE TABLE role (roleid int NOT NULL AUTO_INCREMENT, name varchar(32) NOT NULL, description varchar(128) NOT NULL, PRIMARY KEY (roleid)) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 DEFAULT COLLATE=utf8mb4_general_ci;
DROP TABLE role_permission_link;
CREATE TABLE role_permission_link (roleid int, permissionid int, INDEX roleid (roleid), INDEX permissionid (permissionid)) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 DEFAULT COLLATE=utf8mb4_general_ci;
DROP TABLE user;
CREATE TABLE user (userid int NOT NULL AUTO_INCREMENT, hashed_password varchar(128) NOT NULL, username varchar(64) NOT NULL, create_date datetime DEFAULT current_timestamp(), PRIMARY KEY (userid)) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 DEFAULT COLLATE=utf8mb4_general_ci;
DROP TABLE user_role_link;
CREATE TABLE user_role_link (userid int, roleid int, INDEX userid (userid), INDEX roleid (roleid)) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 DEFAULT COLLATE=utf8mb4_general_ci;
ALTER TABLE `device` ADD FOREIGN KEY (`pollerid`) REFERENCES `poller` (`pollerid`) ON DELETE CASCADE;
ALTER TABLE `role_permission_link` ADD FOREIGN KEY (`roleid`) REFERENCES `role` (`roleid`) ON DELETE CASCADE;
ALTER TABLE `role_permission_link` ADD FOREIGN KEY (`permissionid`) REFERENCES `permission` (`permissionid`) ON DELETE CASCADE;
ALTER TABLE `user_role_link` ADD FOREIGN KEY (`userid`) REFERENCES `user` (`userid`) ON DELETE CASCADE;
ALTER TABLE `user_role_link` ADD FOREIGN KEY (`roleid`) REFERENCES `role` (`roleid`) ON DELETE CASCADE;
